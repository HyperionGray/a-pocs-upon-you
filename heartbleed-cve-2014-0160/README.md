Heartbleed (CVE-2014-0160)
==========================

**Original Discovery:** Neel Mehta (Google Security Team), Riku HietamÃ¤ki, Antti Karjalainen and Matti Kamunen (Codenomicon)  
**Adapted by:**         Hyperion Gray Security Research Team  
**Date:**               2014-04-07 (discovery) / 2024-11-16 (adaptation)  
**CVE:**                [CVE-2014-0160](https://nvd.nist.gov/vuln/detail/CVE-2014-0160)  
**CVSS Score:**         7.5 (High)  
**Advisory:**           https://heartbleed.com/  
**Tested on:**          OpenSSL 1.0.1 through 1.0.1f

Overview
--------

CVE-2014-0160, known as "Heartbleed", is a serious vulnerability in the OpenSSL cryptographic 
software library. This weakness allows stealing information protected by SSL/TLS encryption 
used to secure the Internet. The vulnerability allows anyone on the Internet to read the 
memory of systems protected by vulnerable versions of OpenSSL software.

The bug is in the TLS heartbeat extension (RFC 6520), which allows either endpoint of a TLS 
connection to detect whether the peer is still present even when no data is being transmitted. 
The vulnerability allows an attacker to read up to 64KB of memory from the server or client, 
potentially exposing sensitive data including private keys, passwords, and personal information.

Affected Versions
----------------

- **Vulnerable:** OpenSSL 1.0.1 through 1.0.1f
- **Vulnerable:** OpenSSL 1.0.2-beta through 1.0.2-beta1
- **Not Vulnerable:** OpenSSL 1.0.1g and later
- **Not Vulnerable:** OpenSSL 1.0.0 and earlier (heartbeat extension not implemented)

**Note:** The vulnerability was introduced in OpenSSL 1.0.1 on March 14, 2012, and was 
present in the wild for over two years before discovery.

Technical Details
----------------

The Heartbleed bug is a bounds-checking error in the handling of TLS heartbeat extension 
packets. The vulnerability exists in the `tls1_process_heartbeat()` function in `t1_lib.c`.

**Normal Heartbeat Process:**
1. Client sends heartbeat request with payload and payload length
2. Server reads the payload length from the request
3. Server copies the payload and sends it back
4. Client verifies the returned payload matches what was sent

**Vulnerable Code Flow:**
1. Attacker sends heartbeat request claiming large payload (up to 65535 bytes)
2. Server trusts the attacker-provided length without validation
3. Server copies memory beyond the actual payload boundary
4. Server returns up to 64KB of arbitrary memory contents to attacker

**Memory Layout Exploitation:**
- SSL session keys and master keys
- User credentials (usernames, passwords)
- Personal data (emails, documents, photos)
- Private keys (server certificates, user certificates)
- Memory addresses and system information

**Attack Characteristics:**
- No authentication required
- Leaves no traces in server logs
- Can be repeated multiple times
- Works against both servers and clients
- Exploitable over any TLS connection

Installation
-----------

Install required dependencies:

```bash
pip install socket ssl struct
```

No additional dependencies required - uses Python standard library.

Usage
-----

### Basic Memory Disclosure

Test a server for Heartbleed vulnerability and extract memory:

```bash
# Basic test against HTTPS server
python exploit.py -t example.com -p 443

# Test with verbose output
python exploit.py -t example.com -p 443 -v

# Extract multiple memory chunks
python exploit.py -t example.com -p 443 -n 10
```

### Advanced Options

```bash
# Test specific TLS version
python exploit.py -t example.com -p 443 --tls-version 1.1

# Save extracted memory to file
python exploit.py -t example.com -p 443 -o memory_dump.bin

# Test with custom payload size
python exploit.py -t example.com -p 443 --payload-size 16384

# Quiet mode (only show if vulnerable)
python exploit.py -t example.com -p 443 -q
```

### Batch Testing

Test multiple targets from a file:

```bash
# Test list of hosts
python exploit.py -f targets.txt

# Test common ports on single host
python exploit.py -t example.com --scan-ports
```

### Memory Analysis

Search extracted memory for sensitive data:

```bash
# Look for private keys in extracted memory
python exploit.py -t example.com -p 443 --search-keys

# Search for specific patterns
python exploit.py -t example.com -p 443 --search-pattern "password"

# Extract and analyze cookies
python exploit.py -t example.com -p 443 --extract-cookies
```

Detection
---------

**Network-based Detection:**
- Monitor for TLS heartbeat requests with suspicious payload lengths
- Look for heartbeat requests with length field > actual payload size
- Detect repeated heartbeat requests from same source
- Monitor for unusual TLS handshake patterns

**Host-based Detection:**
- Check OpenSSL version: `openssl version -a`
- Use vulnerability scanners (Nessus, OpenVAS, Nmap)
- Monitor system logs for unusual SSL/TLS activity
- Check for unauthorized access to sensitive files

**Online Testing Tools:**
- https://filippo.io/Heartbleed/
- https://heartbleed.com/
- Qualys SSL Labs SSL Test
- Various Nmap scripts (ssl-heartbleed)

Mitigation
----------

### Immediate Actions

1. **Upgrade OpenSSL immediately:**
   ```bash
   # Check current version
   openssl version -a
   
   # Update to patched version (1.0.1g or later)
   # Ubuntu/Debian
   sudo apt-get update && sudo apt-get upgrade openssl
   
   # CentOS/RHEL
   sudo yum update openssl
   
   # Compile from source if needed
   wget https://www.openssl.org/source/openssl-1.0.1g.tar.gz
   ```

2. **Restart all services using OpenSSL:**
   ```bash
   # Restart web servers
   sudo service apache2 restart
   sudo service nginx restart
   
   # Restart other SSL services
   sudo service postfix restart
   sudo service dovecot restart
   ```

3. **Revoke and reissue SSL certificates:**
   - All SSL certificates should be considered compromised
   - Generate new private keys
   - Obtain new certificates from Certificate Authority
   - Update all systems with new certificates

4. **Reset user credentials:**
   - Force password resets for all user accounts
   - Invalidate all active sessions
   - Review and rotate API keys and tokens

### Long-term Security Measures

- Implement certificate pinning where possible
- Use Perfect Forward Secrecy (PFS) cipher suites
- Regular security audits and penetration testing
- Automated vulnerability scanning
- Keep all cryptographic libraries up to date
- Implement defense-in-depth security measures

Real-World Impact
----------------

Heartbleed was one of the most significant security vulnerabilities in Internet history:

**Affected Systems:**
- Approximately 17% of all SSL-secured web servers (500,000+ sites)
- Major services: Yahoo, Flickr, OkCupid, Eventbrite, Stack Overflow
- Network equipment from Cisco, Juniper, F5, and others
- VPN concentrators and firewalls
- Email servers and instant messaging systems

**Attack Consequences:**
- Theft of private keys enabling man-in-the-middle attacks
- Exposure of user credentials and personal data
- Compromise of secure communications
- Long-term persistent access to encrypted traffic
- Estimated billions of dollars in remediation costs

**Response Timeline:**
- April 7, 2014: Vulnerability disclosed publicly
- April 7, 2014: OpenSSL 1.0.1g released with fix
- April 8-10, 2014: Major sites begin patching and certificate replacement
- Weeks-months: Ongoing remediation across the Internet

References
----------

- [Official Heartbleed Site](https://heartbleed.com/)
- [OpenSSL Security Advisory](https://www.openssl.org/news/secadv/20140407.txt)
- [RFC 6520 - TLS Heartbeat Extension](https://tools.ietf.org/html/rfc6520)
- [NVD Entry](https://nvd.nist.gov/vuln/detail/CVE-2014-0160)
- [XKCD Comic Explanation](https://xkcd.com/1354/)
- [Codenomicon Analysis](https://www.codenomicon.com/resources/heartbleed/)
- [CloudFlare Technical Analysis](https://blog.cloudflare.com/the-results-of-the-cloudflare-challenge/)

Legal Notice
-----------

This tool is provided for educational and authorized security testing purposes only.
Unauthorized access to computer systems is illegal. Always obtain explicit written
permission before testing any system you do not own. The authors and contributors
are not responsible for misuse of this tool.

Use of this tool against systems without permission may violate local, state, federal,
or international laws. Users are solely responsible for compliance with all applicable laws.