Spring4Shell CVE-2022-22965
===========================

**Author:**    Hyperion Gray Security Team  
**Date:**      2024-12-15  
**CVE:**       [CVE-2022-22965](https://nvd.nist.gov/vuln/detail/CVE-2022-22965)  
**Advisory:**  https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement  
**Tested on:** Spring Framework 5.3.0-5.3.17, 5.2.0-5.2.19, and older versions  

Discussion
----------

Spring4Shell is a critical remote code execution vulnerability in the Spring Framework. The vulnerability allows attackers to achieve RCE via data binding when the application runs on Java 9 or later.

The exploit works by abusing Spring's data binding mechanism and accessing the class loader to write a malicious JSP file to the web server. This vulnerability affects:
- Spring Framework versions 5.3.0 to 5.3.17
- Spring Framework versions 5.2.0 to 5.2.19  
- Older unsupported versions

Requirements:
- JDK 9 or higher
- Apache Tomcat as the servlet container
- Spring MVC or Spring WebFlux application
- Application packaged as a traditional WAR (not Spring Boot executable JAR)

## Prerequisites

- Python 3.x
- Required Python packages (see requirements.txt)
- Target running vulnerable Spring Framework application

## Installation

Install dependencies:

    $ pip install -r requirements.txt

## Usage

### Basic Exploitation

Run the exploit against a vulnerable target:

    $ python3 exploit.py --url http://target:8080/vulnerable-app

This will:
1. Attempt to write a webshell to the target
2. Verify the webshell was created
3. Provide instructions for accessing the shell

### Advanced Options

Specify custom webshell path and filename:

    $ python3 exploit.py --url http://target:8080/app --shell-path /tmp --shell-name shell.jsp

Test if a target is vulnerable without exploitation:

    $ python3 exploit.py --url http://target:8080/app --check-only

### Accessing the Webshell

Once the exploit succeeds, access the webshell at:

    http://target:8080/app/shell.jsp?cmd=whoami

You can execute arbitrary commands via the `cmd` parameter:

    $ curl 'http://target:8080/app/shell.jsp?cmd=id'
    $ curl 'http://target:8080/app/shell.jsp?cmd=cat%20/etc/passwd'

## How It Works

The vulnerability exploits Spring's parameter binding mechanism:

1. Spring automatically binds HTTP request parameters to Java object properties
2. All Java objects inherit from `Object`, which provides access to the class loader
3. By carefully crafting request parameters, we can access the class loader
4. We modify the access log configuration to write arbitrary files
5. This allows writing a JSP webshell to the web application directory

The exploit chain:
```
HTTP Parameter → Spring Binding → Class Loader Access → Log Configuration → File Write → RCE
```

## Mitigation

- Upgrade to Spring Framework 5.3.18+ or 5.2.20+
- Upgrade to Spring Boot 2.6.6+ or 2.5.12+
- Downgrade to Java 8 (not recommended as a long-term solution)
- Add `@InitBinder` to disallow access to certain properties
- Implement a web application firewall with Spring4Shell rules

## Security Notice

**This is for educational and authorized penetration testing purposes only.**
Using this exploit against systems without explicit permission is illegal.

## References

- https://spring.io/blog/2022/03/31/spring-framework-rce-early-announcement
- https://www.lunasec.io/docs/blog/spring-rce-vulnerabilities/
- https://tanzu.vmware.com/security/cve-2022-22965
