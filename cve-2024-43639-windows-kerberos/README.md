Windows Kerberos KDC Proxy RCE
===============================

**Author:**    Hyperion Gray Security Research Team  
**Date:**      2025-11-16  
**CVE:**       [CVE-2024-43639](https://nvd.nist.gov/vuln/detail/CVE-2024-43639)  
**Advisory:**  https://www.zerodayinitiative.com/blog/2025/3/3/cve-2024-43639  
**Tested on:** Windows Server 2019, 2022 (KDC Proxy enabled)

Demo
----

_This is a skeleton exploit for research and educational purposes._

Discussion
----------

CVE-2024-43639 is a critical remote code execution vulnerability affecting Microsoft 
Windows servers configured as Kerberos Key Distribution Center (KDC) Proxy Protocol 
servers. The vulnerability stems from an integer overflow and improper validation of 
message lengths when processing Kerberos responses in the KDC Proxy service.

The flaw allows unauthenticated attackers to:
- Send specially crafted Kerberos responses with malformed length fields
- Trigger memory allocation errors and heap corruption
- Achieve arbitrary code execution with SYSTEM privileges

**Attack Requirements:**
- No authentication required
- Target must have an internet-facing KDC Proxy endpoint
- Typically found on Windows Server instances using Remote Desktop Gateway or DirectAccess

**Technical Details:**
The vulnerability exists in `kpssvc.dll` where the KDC Proxy fails to properly validate
the 4-byte length field in Kerberos responses forwarded over HTTPS. When an attacker 
controls the KDC server response, they can cause integer overflow in buffer allocation,
leading to memory corruption and code execution.

Usage
-----

This is a skeleton exploit demonstrating the attack structure. A fully working exploit
would require:

1. Deep knowledge of Windows heap layout and memory corruption techniques
2. Shellcode payload adapted for the target Windows Server version
3. Precise offsets and timing for heap grooming
4. Testing against specific KDC Proxy configurations

To use this skeleton:

    $ python3 exploit_skeleton.py TARGET_HOST TARGET_PORT

Where `TARGET_HOST` is the Windows Server running KDC Proxy and `TARGET_PORT` is 
typically 443 (HTTPS).

**Note:** This skeleton does NOT contain working exploitation code. It demonstrates
the attack structure and would require significant additional work to create a 
functional exploit.

Mitigation
----------

- Apply Microsoft's November 2024 security updates for all Windows Server versions
- Restrict KDC Proxy endpoint access to trusted networks only
- Monitor for suspicious KDC Proxy traffic patterns
- Scan for exposed `/KdcProxy` endpoints in IIS

References
----------

- https://www.zerodayinitiative.com/blog/2025/3/3/cve-2024-43639
- https://cybersecuritynews.com/windows-kdc-proxy-rce-vulnerability/
- https://gbhackers.com/windows-kdc-proxy-rce-vulnerability/
- https://www.cve.news/cve-2024-43639/
